name: GitHub Actions test

on: [push]

jobs:

  build-linux:
 
    runs-on: ubuntu-latest
 
    steps:
    - uses: actions/checkout@master
    - name: Look around
      run: ls
    - name: Get some info
      run: uname -a
    - name: Docker info
      run: docker info
    - name: Docker images
      run: docker images
    - name: Build Docker image
      run: docker build -t http .
    - name: Run container
      run: docker run -d -p 8080:8080 http
    - name: Test container
      run: curl http://localhost:8080

  build-windows:
 
    runs-on: windows-2019
 
    steps:
    - uses: actions/checkout@master
    - name: Look around
      run: dir
    - name: Test FIPS
      run: powershell -Command [System.Environment]::SetEnvironmentVariable('DOCKER_FIPS', '1', 'Machine')
    - name: List env
      run: set
    - name: Restart Docker
      run: |
        net stop docker
        net start docker
    - name: Docker info
      run: docker info
    - name: Docker images
      run: docker images
    - name: Dir docker
      run: dir "C:\Program Files\Docker"
    - name: Dir docker CLI plugins
      run: dir "C:\Program Files\Docker\cli-plugins"
    - name: Get docker CLI plugin version
      run: |
        cd /D "C:\Program Files\Docker\cli-plugins"
        dir
        .\docker-app.exe app version
    - name: Build Docker image
      run: docker build -t http .
